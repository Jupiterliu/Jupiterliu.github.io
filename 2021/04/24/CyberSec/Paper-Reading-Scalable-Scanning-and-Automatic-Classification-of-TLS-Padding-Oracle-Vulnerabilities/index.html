<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Paper Reading: Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities | Titus</title><meta name="robots" content="noindex"><meta name="author" content="Titus"><meta name="copyright" content="Titus"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="USS-2019一篇TLS相关论文阅读和翻译整理"><link rel="shortcut icon" href="/url(https:/jupiterliu.github.io/images/avatar-1.jpeg)"><link rel="canonical" href="https://titus.pub/2021/04/24/CyberSec/Paper-Reading-Scalable-Scanning-and-Automatic-Classification-of-TLS-Padding-Oracle-Vulnerabilities/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/images/siteicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/siteicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/siteicon/favicon-16x16.png"/><link rel="mask-icon" href="/images/siteicon/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?cc0406ed801f1edae76a788eed5f326e";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Titus","link":"链接: ","source":"来源: Titus","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Paper Reading: Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-11-09 19:55:40'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/avatar-1.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Titus</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Paper Reading: Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-04-24T06:54:41.000Z" title="发表于 2021-04-24 14:54:41">2021-04-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-11-09T11:55:40.850Z" title="更新于 2022-11-09 19:55:40">2022-11-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>66分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Paper Reading: Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1>「TLS Padding Oracle漏洞的可拓展扫描和自动分类」</h1>
<p>该论文发表在第28次USS会议上，<a target="_blank" rel="noopener" href="https://www.youtube.com/results?search_query=Scalable+Scanning+and+Automatic+Classification+of+TLS+Padding+Oracle+Vulnerabilities">USS会议演讲视频</a>，<a target="_blank" rel="noopener" href="https://www.youtube.com/results?search_query=Scalable+Scanning+and+Automatic+Classification+of+TLS+Padding+Oracle+Vulnerabilities">国际密码研究协会演讲视频</a></p>
<p>论文项目也已在Github上开源：<a target="_blank" rel="noopener" href="https://github.com/tls-attacker/TLS-Padding-Oracles">TLS Padding Oracles</a></p>
<p>相关：<a target="_blank" rel="noopener" href="https://pentesterlab.com/exercises/padding_oracle/course">PentesterLab: Padding Oracle攻击实战</a></p>
<ul>
<li><strong>文章结构请看右边的目录</strong>👉</li>
</ul>
<h1>摘要</h1>
<p>TLS协议在现代Internet上提供加密、数据完整性和身份验证。尽管该协议很重要，但目前部署的TLS版本使用的是过时的加密算法，这些算法已被各种攻击攻破。此类攻击的一个突出类别是CBC Padding Oracle（CBC填充预示）攻击。这些攻击使得攻击者能够通过观察取决于CBC填充有效性的不同服务器行为来解密TLS通信数据。</p>
<p>我们首次对现代互联网上TLS实现中的CBC Padding Oracle进行了大规模扫描。我们的扫描显示Alexa排名前百万的网站中有1.83%的网站存在漏洞，且检测到近100个不同的漏洞。我们的扫描仪能观察到服务器行为的细微差别，例如使用不同的TLS Alert或使用不同的TCP Header标志进行响应。</p>
<p>我们使用了一种新的扫描方法，包括三个步骤。首先，我们创建了一大组探探针，以相当高的扫描成本来检测漏洞。然后，我们使用初步扫描减少了探针的数量，使得这样一组较小的探针具有相同的检测率，但足够小，可以用于大规模扫描。最后，我们使用减少的探针集合进行大规模扫描，并用一种新的方法使用图形绘制算法对我们的发现进行了聚类。</p>
<p>与普遍的看法相反，利用CBC Padding Oracle并不一定需要执行精确的计时测量。我们检测到只需观察不同服务器响应的内容即可利用该漏洞。这些漏洞在实践中构成的威胁比之前设想的要大得多。</p>
<h1>一、介绍</h1>
<p>在2002年，Vaudenay提出了一种攻击，该攻击的目标是通过密码块链接（CBC）操作模式加密的消息[39]。该攻击利用了CBC模式的可延展性，该模式允许更改密文，以便在不了解加密密钥的情况下翻转特定的明文位。攻击需要服务器解密消息，并根据消息的有效性以1或0响应。这种行为从本质上为攻击者提供了一个加密预言，该预言可用于发起自适应选择密文攻击。攻击者利用这种行为通过执行自适应查询来解密消息。Vaudenay开发出了一种特殊形式的易受攻击的行为，其中的执行会验证CBC填充结构并相应地响应1或0。</p>
<p>此类攻击被称为padding oracle攻击。演示了不同形式的padding oracle攻击可以破坏加密硬件[6]、XML加密[23]或诸如Java Server Faces [33]<a target="_blank" rel="noopener" href="http://xn--ASP-8i4e.NET">和ASP.NET</a> Web应用程序[15]之类的Web技术。 Rizzo和Duong使用padding oracle攻击来窃取秘密并伪造身份验证令牌，从而获得对敏感数据的访问权[15]。在所有这些工作中，攻击者能够使用一个直接的侧信道（不同的错误消息）来实例化padding oracle并解密机密数据。</p>
<p>传输层安全（TLS）在MAC-then-Pad-then-Encrypt方案中采用了CBC模式，这使其很可能受到这些攻击。实际上，已经有人使用了不同类型的CBC Padding Oracle来破坏TLS的保密连接[39，4，3，20]。所有这些攻击都要求攻击者执行精确的计时测量。该要求源于TLS协议的属性。建立TLS连接后，所有TLS错误消息均以加密方式发送，并且长度相同。因此，即使攻击者能够使服务器发送不同的错误消息，攻击者通常也无法在不同的加密响应之间进行区分。</p>
<p>由于大多数先前的分析仅基于计时侧信道来分析padding oracle攻击，因此他们需要在本地环境中测试实现。这些评估发现了许多新漏洞[4、3、20]。但是，针对这些漏洞实施适当的对策非常具有挑战性，并且需要复杂的恒定时间来实现。实施此类对策可能会引入新的攻击也就不足为奇了。例如，为了修复Lucky 13 Padding Oracle，OpenSSL密码库引入了一个不同的漏洞，其中OpenSSL以不同的TLS警报消息进行响应[37]。因此，分析实验室环境中的实现需要对不同实现的每个新版本进行费力的测试。这显然是不现实的，因此这种分析是偶尔执行的。</p>
<p>考虑到恒定时间TLS填充验证的复杂性，我们希望在其他实现中也可能引入类似于OpenSSL [37]引入的漏洞。因此，这项工作脱离了上面的实验室分析方法，而是使用大规模Internet扫描来评估CBC Padding Oracle。我们尝试回答以下两个问题：padding oracle漏洞的普遍程度如何？这些攻击是否只能通过使用定时辅助信道来利用？</p>
<ul>
<li>
<p>**贡献：**在我们的工作中，我们采用了一种新颖的扫描方法，该方法能够大规模扫描TLS CBC Padding Oracle。 我们使用这种方法来发现新的Padding Oracle漏洞并执行负责任的披露。 我们确定了近100种不同的Padding Oracle。 我们表明，其中的某些功能可以在没有细微时序侧信道的情况下被利用，因此与最近发现的Padding Oracle相比，在实践中构成了显着更大的威胁。</p>
</li>
<li>
<p>**新的大规模扫描方法：**大规模扫描padding oracle是一项挑战。这种扫描通过发送不同格式错误的输入并观察服务器行为来检测漏洞。如Böck等人所示 [9]，在某些情况下，这些输入仅在使用特定的TLS版本或密码套件时触发漏洞。使用协议版本、密码套件和格式错误的输入的所有可能组合进行扫描是不可行的，因为这将需要与每个扫描主机建立大量连接。我们通过仔细选择一组探针克服了这一限制，从而可以进行有效的大规模扫描。我们系统地分析了先前在文献[39、4、3、20、37、27、25、10、29、28]中描述的padding oracle。然后，我们仔细选择了25个表现出padding oracle格式错误的输入，我们将其称为格式错误的记录。这些TLS记录展示了有效填充和无效填充以及MAC的不同组合，并且是使用TLS-Attacker框架生成的[37]。即使只有25个格式错误的记录，使用格式错误的记录、TLS版本和密码套件的各种组合进行扫描也是不切实际的。我们将这些组合称为测试向量。我们对具有所有测试向量的50,000个随机TLS主机进行了初步扫描。然后，我们减少了测试向量集，以使在初步扫描中发现的所有漏洞仍然由减少的向量集触发。我们能够在三天内使用减少的测试向量集扫描Alexa前100万个网站。与[9]相似，我们的扫描器不仅在TLS层而且在TCP层观察到不同的服务器响应。我们的结果表明，大约1.83％的TLS服务器易受CBC Padding Oracle攻击。</p>
</li>
<li>
<p>**尽可能减少误报：**当主机首次显示易受攻击的行为时，我们将对其进行重新扫描以确保该行为不是扫描伪像。 如果主机在对我们的每个测试向量的三个独立扫描中具有相同的响应，则我们仅认为它是易受攻击的。 根据此标准，不太可能将主机错误地标记为易受攻击的主机。 因此，我们认为我们的脆弱性统计数据是保守的较低估计值。</p>
</li>
<li>
<p>**近100个不同的padding oracle漏洞：**必须将检测到的漏洞进行聚类以通知不同的供应商。到目前为止，这是手动完成的[9]。为了自动实现此目的，我们针对较大的测试向量集重新扫描了易受攻击的主机。我们将宿主对所有测试向量的响应集称为宿主的响应图。此响应图实质上是主机漏洞的指纹。然后，我们根据扫描的主机的响应图对其进行聚类。该过程确定了93个不同的响应图，即93个不同的漏洞。这些漏洞包括不同的行为，范围从具有不同TLS警报消息的典型padding oracle[39]到特定无效MAC字节触发的TCP连接超时，或在使用无效填充值时观察到的关闭连接。我们将不同的响应图视为不同的漏洞，我们认为这是计算漏洞的自然方法，因为它捕获了在相似但不同的实现中发生的相同漏洞的情况。考虑两个主机对所有测试向量的响应相同。这些主机可能共享实现的相同或非常相似的部分，从而导致漏洞显示具有相同的响应图。但是，它们不一定共享相同的代码。他们可能使用同一TLS库的不同版本，或者使用具有共享组件的两个不同的库。</p>
</li>
<li>
<p>**易受攻击主机的有效群集：**在我们向受影响的各方有责任地披露我们的发现之前，我们先根据脆弱性主机的响应图对其进行分组。 为了进一步完善我们的分组服务器，我们使用了一种基于二维力导向图的图形FortAtlas2算法[21]。 该算法使我们能够创建易受攻击的服务器主机的图表，从而有效地处理我们负责的披露流程。</p>
</li>
<li>
<p>**可以利用的新漏洞：**为了利用填充漏洞，攻击者需要区分不同的响应，以区分正确和不正确的填充。 在TLS中通常不是这种情况：即使服务器发送两个不同的警报消息，消息也会被加密，并且攻击者无法观察到差异。 因此，以前的大多数针对TLS的padding oracle攻击都依赖于计时度量来区分不同的错误情况[4、3、20]。 但是，我们表明，许多TLS实现都会显示出正确填充和错误填充之间的明显差异。 例如，在一种错误情况下，服务器可能会优雅地关闭TCP连接，而在另一种情况下，服务器可能会不优雅地关闭它。 同样，某些服务器会根据特定的填充错误发送不同数量的警报消息，两种行为都很容易观察到。</p>
</li>
<li>
<p>**负责人的披露和道德考量：**与受影响的网站所有者合作，我们以负责任的态度向几家脆弱的供应商披露了我们的发现。 成功攻击的结果是，攻击者能够解密在TLS连接中重复传输的秘密值。 通过执行扫描，我们无法重建服务器私钥或其他机密数据。 我们使用伪数据执行扫描，从未尝试解密真实用户流量。 我们以负责任的方式向以下供应商和受影响的各方披露了我们的发现：IBM，Amazon，Slack，Cisco，Citrix，Oracle，Heroku，Netflix，Sonicwall，Venmo和Vine。</p>
</li>
</ul>
<h1>二、背景</h1>
<p>TLS协议在现代Internet上提供了机密性、完整性和认证性。该协议的最新版本是TLS 1.3 [31]。在撰写本文时，此版本正在逐步使用。在完全部署TLS 1.3之前，被广泛使用的最新版本是TLS 1.2 [14]。现代的客户端和服务器通常还支持两个以前的版本，即TLS 1.0和1.1 [12，13]。在本文的其余部分中，我们仅讨论1.0至1.2版本，这些版本今天已普遍使用并具有相似的结构。 TLS协议包含两个阶段。在称为握手的第一阶段，客户端和服务器选择将用于会话的密码算法并建立会话密钥。在第二阶段，对等方可以安全地发送和接收应用程序数据，这些数据使用上一阶段中建立的密钥和算法进行加密和身份验证。密码算法的上述选择称为TLS密码套件[14]。更确切地说，密码套件是针对所有必需的加密任务的具体算法选择。密码套件是通过将它们对这些算法的选择进行串联来命名的。例如，密码套件TLS_RSA_WITH_AES_128_CBC_SHA使用RSA公钥加密以便在第一阶段建立共享会话密钥，并且还使用具有128位密钥和基于SHA-1的HMAC的对称AES-CBC加密，以便在第二阶段加密和认证数据。</p>
<h2 id="TLS握手协议">TLS握手协议</h2>
<p>客户端使用ClientHello消息发起TLS握手。此消息通告客户端支持的TLS版本和密码套件。然后，服务器使用指定所选密码套件的ServerHello消息进行响应。它还在证书消息中发送其证书，并通过ServerHelloDone消息指示传输结束。然后，客户端生成一个称为预主密码的秘密值，在服务器的RSA密钥下对其进行加密，并在ClientKeyExchange消息中发送加密的密文。在共享了预主秘密的知识之后，双方现在基于预主秘密推导要在会话中使用的对称加密和MAC密钥。最后，双方都发送ChangeCipherSpec和Finish消息。ChangeCipherSpec消息通知接收方后续消息将根据会话密钥并使用密码套件中指定的对称加密和HMAC算法进行加密和验证。完成的消息包含基于从预主秘密派生的密钥对所有先前握手消息计算的HMAC。由于此消息是在ChangeCipherSpec消息之后发送的，因此它是会话中使用对称加密和MAC进行加密和验证的第一条消息。如果完成的消息在两端都正确解密和验证，则双方现在都可以安全地交换应用程序数据。</p>
<h2 id="CBC分组密码链接模式">CBC分组密码链接模式</h2>
<p>TLS中可能的加密算法有很多，但本文主要研究的是CBC加密模式。在CBC模式下，每个明文块在被块密码加密之前与前一个密文块进行异或运算。形式上，如果我们用Pi表示明文块（i=0，…），密文块用Ci表示，并且用密钥k下的块密码加密为Enck()，则Ci=Enck(Pi⊕C(i−1))，(i=1，…)。除了第一个块之外的所有块都是如此，在第一个块中没有先前的密文块，相反，该块在加密之前与初始化向量(IV)进行异或运算：C0=Enck(P0⊕IV)。</p>
<ul>
<li>**CBC模式的延展性：**CBC模式允许攻击者在不知道对称密钥的情况下执行有意义的明文修改。具体地说，假设攻击者知道原始明文Pi的某个块，并且想要更改密文，使得块i改为解密为Pi’。攻击者可以将先前的密文块C(i−1)更改为C(i−1)=C(i−1)‘⊕Pi⊕Pi’。这是以破坏前一个块为代价的，该块现在被解密为攻击者通常无法预测的值。此外，攻击者可以在使用此技术时更改块的顺序。如果攻击者知道明文块Pi并用Ci替换密文块Cj，则块j现在将解密为Pj’=Pi⊕C(i−1)⊕C(j−1)。CBC模式的这种“延展性”特性已经被用于许多密码攻击，也是本文介绍的攻击的基石。</li>
</ul>
<h2 id="TLS记录层">TLS记录层</h2>
<p>TLS记录层封装协议消息。本质上，记录层用包含消息长度、消息类型和协议版本的报头包装协议消息。一旦交换了ChangeCipherSpec消息，后续的TLS记录将封装加密的消息。</p>
<p>在我们的工作中，我们主要关注使用CBC操作模式的密码套件。这些密码套件使用消息验证码(MAC)来保护TLS记录的真实性，并在CBC模式下使用块密码(例如，AES或3DES)加密应用程序数据。TLS规范规定了MAC-Then-Pad-Then-Encrypt机制[14]。加密器首先计算明文上的MAC，将MAC连接到明文，填充消息以使其长度是块长度的倍数，最后在CBC模式下使用分组密码加密MAC和填充的明文。</p>
<p>TLS指定填充字节的精确值，填充明文的最后一个字节指定使用多少个填充字节，不包括最后一个字节。其余填充字节的值与最后一个字节的值相同。例如，如果使用4个填充字节(包括最后一个字节)，则所有4个字节的值将为0x03。</p>
<p>为了演示整个过程，如果加密器使用TLS_RSA_WITH_AES_128_CBC_SHA密码套件加密5个字节的数据，他将使用HMAC-SHA(其输出为20字节长，固定长度输出)和AES-CBC。对原始明文应用HMAC-SHA后，连接长度为25字节，适合两个AES 16字节块（AES是分16字节块加密，也即128bit位块加密）。加密器通常会选择最小可行填充量，在本例中为7字节。第一个块包含数据和前11个HMAC字节。第二个块包含剩余的9个HMAC字节和7个字节的填充0x06，见图1。请注意，加密器还可以选择较长的填充，并附加23、39、…或247个填充字节(同时相应地设置填充字节的值)。</p>
<p><img src="/images/USS-2020-paper/Figure-1.jpg" alt="Figure-1：当使用AES-CBC和HMAC-SHA处理5个明文字节时，加密器需要附加20个字节的HMAC-SHA输出和7个字节的填充"></p>
<h1>三、Padding Oracle漏洞的历史</h1>
<p>SSLv3和TLS中的主要设计失败之一是CBC密码套件中的MAC-then-Pad-then-Encrypt方案规范。 该方案负责对TLS实现的一系列攻击，这些攻击称为padding oracle攻击。 即使在TLS规范[14，第6.2.3.2节]中明确总结了这些对策，但其正确实施仍具有挑战性。</p>
<h2 id="Vaudenay式的Padding-Oracles攻击">Vaudenay式的Padding Oracles攻击</h2>
<p>2002年，Vaudenay证明了MAC-Then-Pad-Then-Encrypt方案在安全协议中引入了潜在的漏洞，其形式就是所谓的padding oracle[39]。利用这些漏洞的攻击基于CBC操作模式的延展性。我们关注的是TLS的案例。</p>
<p>使用CBC模式时，请考虑TLS记录层。解密后，解密方需要验证填充字节和MAC字节。实施这两个检查的自然方法是首先验证填充字节，如果它们验证正确，则验证MAC字节。如果填充字节无效，实现自然会发出错误消息，而不检查MAC字节。另一方面，如果填充字节有效但MAC无效，则自然会发出(可能不同的)错误消息。</p>
<p>假设解密器在这些情况下确实发出两个不同的错误消息。攻击者可以按如下方式解密任何消息块PI的最后一个字节。他将最后一个密文块设置为Ci，并用0到255之间的值替换前一个块C(i−1)的最后一个字节。如果最后一个明文字节是0x00，则填充将是有效的(其他形式的有效填充的可能性要小得多)。当填充字节被正确验证时，攻击者通过观察解密器发出“无效MAC”错误而不是“无效填充”错误来检测到这一点。攻击者在向解密器发送最多255个密文之后获知Pi的最后一个字节的值。</p>
<p>利用他对最后一个明文字节的了解，攻击者可以继续解密Pi的倒数第二个字节。通过这样做，他的目标是创建长度为2的有效填充。更广泛地说，使用这种技术，攻击者可以迭代地解密Pi中的每个字节。我们省略了对其余攻击的正式描述，请读者参考[39]。</p>
<p>请注意，上述攻击依赖于区分解密为有效和无效填充的密文的能力。因此，对于TLS实现来说，通过确保它们始终发出相同的错误消息来防止这种攻击似乎微不足道。事实上，Vaudenay并不知道攻击者可以在TLS上下文中直接区分这两种情况。原因是，即使TLS错误消息不同，也不可能区分它们，因为它们是用TLS会话密钥加密的。这是我们在工作中应对的挑战之一。</p>
<h2 id="BEAST攻击模型">BEAST攻击模型</h2>
<p>Vaudenay的论文中留下了一个悬而未决的问题，那就是如何利用他所说的“爆炸性先知”——一种只有在第一次返回否定答案之前才能使用的先知。这模拟了这样的问题：一旦消息没有正确解密，TLS实现就会中止会话。因此，一旦出现第一个解密错误，依赖于TLS会话中更改消息的攻击者将无法继续攻击。</p>
<p>Canvel等人使用了一种模型，其中客户端重复连接到服务器[11]，观察到这是由于当时电子邮件客户端的轮询行为而发生的，并泄露了认证密码。BEAST攻击[34]本质上使用了相同的模型，但更依赖于现代网络浏览器的行为。在最简单的BEAST模型中，受害者被骗访问由攻击者控制的恶意网站。该网站包含使受害者浏览器重复连接到受害者网站的Javascript。然后，每个网站请求都包含用户身份验证Cookie，该Cookie由浏览器自动发送。此行为允许攻击者强制受害者重复向服务器发送加密值。</p>
<p>我们的攻击就是在这种模式下进行的。我们假设攻击者可以导致受害者客户端重复连接到受害者服务器，同时重新传输相同的敏感信息。我们还假设攻击者是中间人(MITM)，可以在传输过程中更改消息。这种模式现在已经成为现代攻击的标准文献。</p>
<h2 id="POODLE攻击">POODLE攻击</h2>
<p>TLS的前身SSLv3使用类似的先MAC后Pad再加密的方案。但是，与TLS不同的是，SSLv3中填充字节的值未指定。明文的最后一个字节表示存在多少填充字节，但其余填充字节可以取任何值。</p>
<p>考虑一条具有16个填充字节的完整块的消息。明文块的最后一个字节为0x0F，前15个字节可以取任何值。因此，攻击者可以使用3.1节中描述的技术（Vaudenay攻击），用最后一个字节解密为0x0F的任何块替换最后一个块，并获得有效填充的消息。SSLv3的这一特性导致了称为“POODLE”的毁灭性攻击。有关攻击的完整描述，请参见[27]。</p>
<p>尽管POODLE依赖于SSLv3中未指定的填充字节，但令人惊讶的是，它也会影响TLS实现。本质上，不会强迫粗心的TLS开发人员在解密后验证(指定的)填充字节；即使根本不检查填充字节，TLS实现也可以很好地互操作。事实上，开发人员更容易在TLS实现中重用处理SSLv3填充的相同代码。这导致了POODLE攻击的一种变体，影响了TLS的实施[25]。即使在这两个备受瞩目的发现之后，POODLE的变种仍在不断涌现[10，29，28]。这些工作检测到了不同的TLS记录处理漏洞；一些TLS实现只验证了第一个MAC字节，其他实现跳过了对特定填充字节的验证。</p>
<h2 id="Lucky13和其他时间侧信道攻击">Lucky13和其他时间侧信道攻击</h2>
<p>2013年，阿尔法登(AlFardan)和帕特森(Paterson)[4]使用类似的技术打破了TLS的机密，并将他们的攻击命名为“幸运13号”(Lucky 13)。该攻击依赖于一个重要的观察结果：在处理不同长度的输入时，常见的HMAC函数需要不同的处理时间。通过执行巧妙的填充字节操作，攻击者可以强制服务器对不同长度的明文执行HMAC计算。这是因为填充长度决定了用作HMAC函数输入的数据量。然后，攻击者可以测量不同的处理时间并了解有关填充字节的信息。我们建议读者参考[4]以获取完整的攻击描述。</p>
<p>Lucky 13的修复是将TLS实现中的MAC验证码更改为恒定时间，而不考虑处理的明文块的数量。这是可能的，但编写和维护这样的代码是困难的，即使对专家来说也是如此。2016年，Somorovsky在OpenSSL的补丁代码中发现了一个漏洞[37]。该漏洞引入了一个类似的、甚至更严重的漏洞，使得攻击者能够区分两条警报消息。如果解密的消息仅包含两个或更多有效填充块，则可以触发不同的消息。</p>
<p>亚马逊的s2n TLS库发布于2015年[24]，也就是Lucky 13攻击事件发布之后。s2n的开发者意识到了Lucky 13，并引入了特定的对策，似乎使代码保持恒定时间，从而预防了攻击。他们还引入了随机计时延迟，以便在意外情况下代码被证明是易受攻击的，从而使攻击变得更加困难。尽管做了这些努力，s2n仍然容易受到Lucky 13[3，35]变种的攻击。尽管代码已经过正式验证，但还是发现了所有漏洞。</p>
<h2 id="Bleichenbacher攻击及其变种">Bleichenbacher攻击及其变种</h2>
<p>Bleichenbacher的攻击[8]也是一种padding oracle攻击。它针对的不是对称加密，而是RSA加密中使用的填充方案，称为PKCS#1v1.5。它还类似地利用RSA加密的可延展性属性，并依赖于解密器(即服务器)在无效填充明文的情况下发出错误消息。标准对策类似于CBC Padding Oracle；当在RSA解密中遇到错误状态时，服务器的行为不能有任何不同。这一反制措施已成为TLS标准的一部分。</p>
<p>然而，正确实施对策是具有挑战性的。Böck等人已扫描易受Bleichenbacher攻击的易受攻击的TLS服务器[9]。他们发现Facebook和Paypal等知名网站使用的服务器存在漏洞。有趣的是，它们的漏洞可以通过使用不同的TLS协议流或利用TCP连接状态(TCP重置或超时)触发。与CBC Padding Oracle一样，Bleichenbacher的攻击显示出类似的攻击变种序列，每隔几年就会在不同的上下文中被发现[26，22，6]。</p>
<h1>四、扫描与评估的方法论</h1>
<p>我们研究的最终目标是估计padding oracle漏洞的数量和影响，并将我们的发现报告给负责的供应商。 为此，我们分三步进行：我们首先<strong>定义</strong>一个测试向量列表，这些向量可能触发可观察到的差异，从而导致Padding Oracle。 然后，我们减少该测试向量列表，并进行大规模扫描。 最后，我们分析发现的漏洞和负责任的供应商。</p>
<h2 id="测试向量生成">测试向量生成</h2>
<p>为了在实现中检测Padding Oracle，我们连接并发送各种格式错误的记录。这些记录包含有关Padding、MAC和App Data的不同缺陷。然后，我们观察TLS层或更低层的响应是否存在任何差异。对两个格式错误的记录作出不同响应的实现可能容易受到攻击。使用所有可能的格式错误的记录进行测试是不可行的。例如，易受攻击的实现可以正确地检查所有填充字节，除非填充字节正好是16字节长，在这种情况下，该实现不检查填充中的特定位。</p>
<p>由于可能有多达256个填充字节，所以测试所有可能的填充长度的每个位的正确有效性将需要用263,168个不同的记录进行测试。这些记录需要用不同的密码套件或协议版本进行测试，这使得这样的综合测试是不可行的。因此，我们仔细挑选了一组畸形记录（关键方案），这些记录是由先前的研究推动的。</p>
<p>我们承认，这种选择格式错误记录集的方式意味着我们只能检测到与已知漏洞相似的漏洞。然而，这种方法性价比高，非常适合大规模扫描。由于在大规模扫描期间只能将有限数量的消息发送到各个服务器，因此测试向量生成的自动方法(如模糊)通常是不可行的。</p>
<h3 id="格式错误记录">格式错误记录</h3>
<p>我们的格式错误的记录都有80个字节长。长度相等可确保响应差异很可能是由填充Oracle漏洞引起的，而不是由不同记录长度触发的误报。异常的记录长度可能会导致与解密无关的错误；例如，如果加密的TLS记录小于MAC长度（20字节，即TLS记录长度小于20字节），则最新的OpenSSL版本会响应不同的错误消息。我们决定使用80个字节来为HMAC输出（输出为20字节）加上两个完整的填充块提供足够的空间。这允许我们构造受SHA-384保护的记录，其输出长度为48字节。（SHA-384的输出为48字节）</p>
<p>我们在下面的段落中总结了我们的25条格式错误记录。有关TLS_RSA_WITH_AES_128_CBC_SHA情况下这些错误记录的摘要，另请参见表1。</p>
<p><img src="/images/USS-2020-paper/Table-1.jpg" alt="Table-1：为TLS_RSA_WITH_AES_128_CBC_SHA构建的格式错误记录的摘要。这些列分别表示MAC和填充字节的长度、位置和修改。⊕表示对列表位置中的列表值进行异或运算。DEL表示删除列出位置中的一个字节。"></p>
<ul>
<li>
<p>**翻转的MAC位：**我们从包含应用程序数据、MAC和四个填充字节的有效记录开始。（原始TLS记录）然后，我们根据该记录创建“三条”格式错误的记录：（修改原始TLS记录得到的3条新的有错误的TLS记录）</p>
<ol>
<li>
<p>一条是通过翻转第一个MAC字节中的最高有效位，</p>
</li>
<li>
<p>一条是通过翻转MAC字节中间的中间位，</p>
</li>
<li>
<p>另一条是通过翻转最后一个MAC字节的最低有效位。</p>
</li>
</ol>
<p>我们选择这些格式错误的记录来检测那些未完全检查MAC的实现。最近的OpenSSL漏洞[1]，其中OpenSSL只检查某些平台上每个字节的最低有效位，以及未完成MAC验证导致的进一步漏洞[29，28]，导致了特定的位翻转位置。</p>
</li>
<li>
<p>**缺少一个MAC字节：**我们从包含空应用程序数据但具有有效MAC和填充的有效记录开始。（原始记录）然后，我们修改它以创建两个格式错误的记录：（由原始记录修改后的2个错误记录）</p>
<ol>
<li>
<p>一个删除第一个MAC字节，</p>
</li>
<li>
<p>另一个删除最后一个MAC字节。</p>
</li>
</ol>
<p>然后，我们在两条消息中添加另一个填充字节。这些格式错误的记录还可能触发由不完整的MAC验证引起的漏洞，并由[28]间接激发。</p>
</li>
<li>
<p>**缺少MAC字节部分：**受[37]的启发，我们创建了两个格式错误的记录，它们只包含填充，而根本不包含MAC：（由原始记录修改后的到的错误记录）</p>
<ol>
<li>
<p>一个提供了恰好80字节的有效填充(0x4F)，</p>
</li>
<li>
<p>另一个提供了值为0xFF80字节的不完整填充。</p>
</li>
</ol>
<p>这个错误记录不仅缺少MAC，而且还包含无效的填充（因为如果最后一个字节的值是0xFF，则应该有256个填充字节）</p>
</li>
<li>
<p>**组合有效和无效的MAC和填充：**最后一组格式错误的记录包含三种类型的有效和无效MAC和填充的组合的消息：</p>
<ol>
<li>
<p>有效MAC和无效填充（有3个子类型）</p>
</li>
<li>
<p>无效MAC和无效填充（有3个子类型）</p>
</li>
<li>
<p>无效MAC和有效填充（有3个子类型）</p>
</li>
</ol>
<p>对于这三种类型中的每一种，我们都创建了三个子类型，具体取决于我们翻转的位位置；</p>
<p>3个子类型：我们分别翻转第一个、中间或第16个字节中的最高有效位、中间位或最低有效位。对于这九个子类型中的每一个，我们分别创建一个包含应用程序数据的版本和一个不包含应用程序数据的版本。其中选择应用程序数据的长度，使得填充字节包含在一个纯文本块内，而没有应用程序数据的格式错误的记录包含多于一个填充块。这旨在检测只检查最后一块填充字节的实现。</p>
</li>
</ul>
<h3 id="将格式错误的记录与协议版本和密码套件组合">将格式错误的记录与协议版本和密码套件组合</h3>
<p>我们将每个格式错误的记录与几个TLS协议版本和密码套件一起使用。如前所述，我们使用术语测试向量来指代格式错误的记录、协议版本和密码套件的组合。正如我们稍后所展示的，使用不同的协议版本和密码套件测试每个格式错误的记录是必要的；某些漏洞只有在这种特定组合下才会被触发。乍一看，这是令人惊讶的，但这实际上遵循了[9]的发现。我们推测，根据协商的版本和密码套件，实现可能使用完全不同的代码栈，而某些漏洞只存在于这些代码栈的一个子集中。</p>
<h2 id="经验检验向量规约">经验检验向量规约</h2>
<p>根据服务器的配置，上面的测试向量集合相当大。</p>
<p>1.为什么集合大：假设一台支持TLS 1.0和TLS 1.1的服务器具有10个CBC密码套件，那么将有10·2·25=500个测试向量。（请注意，每个测试向量都需要建立新的TLS连接并执行昂贵的握手）</p>
<p>2.不足之处：如此大量的测试向量不允许我们执行大规模扫描。另一方面，删除测试向量可能会导致漏报和漏掉漏洞。（所以不能轻易删除测试向量）</p>
<p>3.解决办法：（新方法）为了在不降低检测率的前提下减少测试向量的数量，我们提出了一种经验测试向量约简方法。</p>
<p>4.实验过程：（扫描—&gt;分析—&gt;筛选创建）我们抽样了50,000台随机主机，它们在端口443上响应。然后，我们使用上述25条格式错误的记录以及所有支持的密码套件和TLS版本组合对这些主机执行完全扫描。然后，我们可以分析我们的测试向量组合，并创建检测所有填充Oracle漏洞的最小测试向量集。这些经验步骤确保了（上述实验和方法的优点）：</p>
<p>1)我们不会遗漏漏洞的概率很高</p>
<p>2)我们可以使用约简集进行大规模分析。</p>
<h2 id="群集漏洞">群集漏洞</h2>
<p>一旦我们减少了测试向量的数量，我们就可以执行完全扫描。为此，我们使用Internet顶级列表之一，该列表通常包含最新服务器实现的良好混合。在互联网顶级列表中，Alexa Top 100万数据集包含响应TLS连接的主机数量最多(约75%)，建议用于TLS扫描[36]。</p>
<p>在使用精简向量集执行TLS扫描后，我们创建了易受攻击主机的列表。我们使用完整的测试载体列表重新扫描这些主机。其中：对于每台主机，我们都存储其响应映射。响应图描述了响应我们的测试向量时的完整主机行为。响应映射由密码套件指纹组成。密码套件指纹描述特定密码套件和TLS版本的服务器响应行为。</p>
<p>我们的主要目标之一是通知易受攻击的供应商。为此，有必要使用生成的响应映射对易受攻击的主机进行分组，并联系其管理员以找出易受攻击的实施版本。Böck等人手动执行此步骤，并能够与最重要的供应商接洽[9]。然而，这样的方法费时费力且容易出错。我们的目标是自动对易受攻击的实现进行分组。</p>
<p>尽管在给定所有响应映射的情况下，对易受攻击的主机进行分组似乎很容易，但即使它们使用相同的易受攻击的实现版本，响应映射也会有所不同。运行相同实现的TLS服务器可以使用不同的配置，从而启用不同的密码套件和TLS版本。例如，服务器A可能容易受到填充Oracle的攻击，并且只启用了一个TLS密码套件：TLS_RSA_WITH_AES_128_CBC_SHA256。服务器B使用相同的密码套件指纹易受攻击。但是，服务器B也被配置为使用不容易受到攻击的附加密码套件。这两台服务器使用的是相同的实现还是相似的实现？为了估计这一点，我们设计了一种基于二维力有向图绘制算法的新方法[21]。这些算法在平面上嵌入一个节点网络，允许在空间上解释该网络。他们通过创建一个包含尽可能少的交叉边的二维图来实现这一点。在我们的方法中，我们使用ForceAtlas2算法[21]：ForceAtlas2模拟物理系统以使网络空间化。节点像带电粒子一样相互重复脉冲，而边缘则像弹簧一样吸引它们的节点。这些力量创造了一种汇聚到平衡状态的运动。这一最终配置预计将有助于对数据的解释[21]。</p>
<p>我们将扫描结果表示为如下：图中的每个节点代表一台主机。如果每对主机的响应映射不包括同一密码套件的不同密码套件指纹，则每对主机由一条边连接。</p>
<p>这种方法在我们的数据集上运行良好，表现出类似漏洞的服务器被紧密地分组在一起。我们通过根据节点的度(即它们的边数)给节点着色来扩充图。由此产生的可视化行为允许识别类似的实现。我们在第八节（Finding）给出了具体的结果。</p>
<h1>五、大规模TLS扫描</h1>
<p>我们使用TLS- Attacker [37]开发了Padding Oracle测试向量，TLS- Attacker [37]是对TLS实现进行系统分析的框架。 TLS-Attacker支持创建恶意TLS工作流和消息格式错误。TLS-Attacker之前的局限：TLS-Attacker已被用于检测Padding Oracle攻击，但仅针对实验室条件下的特定实现，而不是大规模的。我们创建优化的测试向量集的方法以前未包含在此框架中。</p>
<h2 id="TLS搜寻器">TLS搜寻器</h2>
<p>为了扫描大量的主机，我们开发了一个并行扫描多台服务器并将扫描结果写入数据库的框架。这允许我们通过使用多台机器来并行扫描。该数据库提供了扫描数据的查询接口，这使得对大型结果数据集的分析变得更容易。我们称我们的框架为TLS-Crawler。</p>
<p>TLS-Crawler分为一个控制器实例（Director实例）和可能的多个工作实例（Worker实例）。</p>
<ol>
<li>
<p>工作实例（Worker实例）：Worker实例逐个执行实际的TLS主机扫描。每个Worker实例都实现了一个线程池，该池跨可用线程分配扫描工作。然后，该实例将结果捆绑在一起，并协调并行化的数据库访问。</p>
</li>
<li>
<p>控制器实例（Director实例）：控制器实例协调工作实例。Director实例包含一个协调提供程序，负责协调和分配工作人员之间的扫描任务。使用持久性提供程序将结果持久保存在数据库中。我们使用MongoDB作为持久化提供者，并通过Redis队列编排实例。</p>
</li>
</ol>
<p>图2可视化了TLS-Crawler架构。</p>
<p><img src="/images/USS-2020-paper/Figure-2.jpg" alt="Figure-2：我们的TLS扫描基础设施基于用于数据持久性的成熟组件和用于执行TLS评估的TLS-Attacker。"></p>
<h2 id="执行TLS扫描">执行TLS扫描</h2>
<p>在使用测试向量扫描每台主机之前，我们会执行简短扫描，以了解主机支持的CBC密码套件和TLS协议版本。我们将导出和匿名密码套件排除在这些测试之外，因为它们已经被MITM（中间人攻击）攻击者轻易破解。然后，我们使用针对每个CBC密码套件及其支持的协议版本的一组测试向量来执行扫描。</p>
<p>以前的大规模TLS扫描主要集中在TLS握手中的漏洞[9，2]、证书[19]，或者在TLS握手成功之前可能触发的漏洞[17]。这些以前的扫描只需要成功握手一次，通常使用通常支持的密码套件。相反，为了测试Padding Oracle漏洞，有必要对每个测试的密码套件执行完整的TLS握手。这一点由于TLS实现表现出容忍[7]而变得复杂，这可能会阻止服务器完成TLS握手，甚至不能响应初始的ClientHello消息。我们试图将这些容忍度对扫描的影响降到最低，但20%的服务器表现出足够的容忍度，以至于我们无法有效地扫描它们。</p>
<p>即使完成了TLS握手，也不能保证我们可以有效地扫描主机。例如，在某些测试中，目标主机会暂时停止响应几秒钟。这很可能是因为作为拒绝服务防御的一部分，服务器崩溃或阻止了我们的请求。为了避免此类扫描的漏报，我们并行扫描多台主机(最多2000台)，这样就不会有主机被我们的请求超载。此外，我们在扫描具有两个密码套件/版本对的主机之间至少等待10秒，进一步限制了扫描的主机上的负载。</p>
<p>执行这些扫描时，选择适当的超时非常重要。如果超时时间太短，我们可能会因为服务器负载过高而错过响应。相反，较高的超时值会降低扫描性能。设置较高的超时值还意味着我们不再区分立即关闭连接的服务器和需要明显时间来恢复和关闭连接的服务器。此外，服务器的答案可能跨越多个TCP数据包，因此没有简单的方法来确定扫描仪在任何时间点都收到了服务器的完整答案。(某些响应不包括TCP RST或FIN数据包。)。我们根据经验确定，一秒的超时在实践中效果很好，并且在很大程度上保证了服务器确实有足够的时间来处理我们的记录和响应。然而，即使在使用此超时值时，我们也发现服务器由于高负载或各种错误而做出不确定的响应。</p>
<p>为了解决不确定性响应，我们重新扫描了每个可疑漏洞，以避免误报。只有当一台服务器在三次单独的扫描中对我们的每个测试向量做出相同的响应时，我们才认为它是易受攻击的。</p>
<h1>六、评估</h1>
<p>对于扫描，我们使用了一台具有2个Xeon E5-2683v5 CPU（总共64个内核）和48 GB RAM的计算机。 扫描平均使用5Mbit / s的上游数据和15Mbit / s的下游数据。</p>
<h2 id="对所有格式错误的记录进行预扫描">对所有格式错误的记录进行预扫描</h2>
<p>我们对50,000台随机TLS主机执行了初步扫描，旨在减少格式错误的记录集。扫描发生在2018年10月，需要三天时间。结果证实，密钥交换算法和协议版本的选择确实会影响给定主机是否存在CBC Padding Oracle漏洞。然后，我们减少了这组畸形记录。为此，我们首先确定了所有易受攻击的主机，即在扫描全部格式错误的记录时将被识别的主机。然后，我们检查了大小不断增加的错误记录的子集，并针对每个子集检查了仅使用该错误记录子集扫描时可以识别的主机数量。当四条错误记录的子集识别出所有易受攻击的主机时，此过程停止。也就是说，当使用完整的格式错误记录集扫描时，将标识的所有主机也将在使用减少的格式错误记录集扫描时被标识。此缩减集合包括以下格式错误的记录(所有这些记录的长度均为80字节)：</p>
<ol>
<li>
<p>缺少MAC和正确填充的记录(值为0x4F)。</p>
</li>
<li>
<p>缺少MAC且填充错误的记录(值为0xFF)。</p>
</li>
<li>
<p>无申请数据、填充无效、MAC有效的空记录。翻转第一填充字节中的最高位。</p>
</li>
<li>
<p>没有应用数据的空记录，填充有效，MAC无效。第一个MAC字节中的最低位被翻转。</p>
</li>
</ol>
<p>请注意，我们仍然使用所有支持的密码套件和TLS协议版本测试每台TLS主机。</p>
<ul>
<li>**格式错误的记录集缩减是否有损？**缩小的格式错误记录集在初步扫描的样本数据上检测由较大的原始格式错误记录集检测到的所有漏洞。自然会询问是否存在易受原始集合中的错误记录攻击的主机，但不存在易受精简集合中的错误记录攻击的主机。在样本数据中显然没有这样的主机，但是在样本之外可能有这样的主机。如果Internet上有大量这样的主机，则错误记录减少过程将是有损失的，也就是说，通过使用较少的错误记录，我们在完整扫描中检测到的漏洞较少。正如我们现在解释的那样，这种扫描不精确度的来源可能足够小，不会对我们的结果产生实质性影响。换句话说，减少的格式错误记录集可能会检测到由整个格式错误记录集触发的大多数漏洞，而不仅仅是样本数据。</li>
</ul>
<p>实际上，让p表示在所有讲TLS的主机中，易受来自全部错误记录集合中的一个错误记录的影响的主机的百分比，而不是易受来自精简集合的任何错误记录的影响的百分比。也就是说，p描述了缩减遗漏的主机百分比；我们现在将显示它相当小。在用于初步扫描的N=50000台主机的随机样本中，我们没有遇到任何此类主机。<br>
为了计算99%的置信区间，我们需要(1−p)^N=0.01.。求解p，我们得到p=0.0092%。因此，我们以99%的把握确定，由于错误记录减少，我们的扫描最多会遗漏0.0092%的其他易受攻击的主机。</p>
<p>为了方便读者，我们对以上内容进行了直观的解释。根据上面的计算，我们估计由于使用减少的格式错误记录集进行扫描而漏掉的Internet上易受攻击主机的百分比为0.0092%。Censys[16]估计，截至2019年2月，大约有4240万台主机在端口443上为TLS提供服务。因此，我们估计减少最多会丢失42400000台·0.0092%=3,900台主机。直观地讲，“99%可信区间”这个术语的意思是这个估计错误的可能性大约是1%，即互联网上有超过3900个这样的主机。</p>
<h2 id="Alexa-Top-100万扫描">Alexa Top 100万扫描</h2>
<p>我们使用减少的畸形记录集扫描Alexa TOP百万网站。在排名靠前的列表中，Alexa Top 100万提供支持TLS的主机百分比最高[36]，因此适合大规模TLS扫描。该列表可能包括大多数备受瞩目的TLS实现。</p>
<p>扫描大约需要72小时。在最初的100万台主机中，785,295台主机在端口443上响应。我们能够使用CBC密码套件与627,493台主机进行TLS握手。我们将所有其他东道主排除在评估之外。我们发现总共有18,257台Alexa Top Million主机(1.83%)容易受到Padding Oracle攻击。</p>
<p>这些数据支持我们的猜想，即在具有一个协议版本的密码套件上实现可能易受攻击，而在具有不同协议版本的同一密码套件上不受攻击。共有649台服务器仅在TLS 1.0或TLS 1.1/1.2中易受攻击，尽管其他版本支持易受攻击的密码套件。同样，在某些情况下，协商的密钥交换算法会影响实现是否显示CBC漏洞。601主机在一个密码套件上易受攻击，但在使用不同密钥交换算法但使用相同对称密码和HMAC函数的另一个密码套件上不受攻击。共有3247台主机在它们支持的所有CBC密码套件上易受攻击。</p>
<p>识别出易受攻击的主机后，我们使用全套测试向量重新扫描它们，以获得它们的完整响应图。如上所述，要将主机标记为易受攻击的主机，我们要求响应映射在三次不同扫描中保持一致。</p>
<h2 id="我们聚类方法的结果">我们聚类方法的结果</h2>
<p>手动分析每台易受攻击的主机是不可行的。因此，我们将易受攻击的主机聚集在一起，以便显示相同密码套件指纹的主机聚集在一起。这最大限度地减少了确定对每个易受攻击的行为负责的供应商(或多个供应商)所需的手动工作。我们重申，正如第4.3节所解释的那样，这种集群不是微不足道的。</p>
<p>我们识别了93个不同的密码套件指纹。表2总结了40种最常见的密码套件指纹。<br>
以第一行为例，7297台主机以BAD_RECORD_MAC和CLOSE_NOTIFY TLS警报响应，并使格式错误的记录11和12的连接超时。对于所有其他格式错误的记录，这些主机关闭了TCP连接。在发送相同的TLS警报之后。</p>
<p>我们还确定了四组表现出与OpenSSL[37]中的CVE-2016-2107漏洞类似的行为(表2中的密码套件指纹#41、#75、#14和#54)。它们以RECORD_OVERFLOW TLS警报响应格式错误的记录6和7(参见表1)。对于所有其他格式错误的记录，它们以BAD_RECORD_MAC响应。这些可能是未打补丁的OpenSSL实现，或者是运行较旧OpenSSL版本的安全设备。</p>
<p><img src="/images/USS-2020-paper/Table-2.jpg" alt="Table-2"></p>
<p><img src="/images/USS-2020-paper/Table-2-exp.jpg" alt="Table-2中的符号解释"></p>
<p>对于同一主机上易受攻击的密码套件，密码套件指纹基本一致。在表现出至少一个易受攻击的密码套件的主机中，99.6%的主机在所有易受攻击的密码套件上具有相同的密码套件指纹。我们删除了剩余0.4%的主机以简化群集。然而，在易受攻击的密码套件上共享相同密码套件指纹的主机不一定共享相同的实现。例如，假设两台主机A和B都有两个受主机1和2支持的密码套件。A在具有密码套件指纹X的密码套件1上易受攻击，但在密码套件2上不易受攻击。B在密码套件1上不易受攻击，但在具有相同密码套件指纹X的密码套件2上易受攻击。这种差异表明主机不共享相同的实现，因为我们期望共享实现具有一致的易受攻击的密码套件集。(我们承认，尽管共享相同的实现，但由于配置标志不同，主机可能表现出不同的行为，但我们认为这不太可能)。</p>
<p>我们将上述情况(在其一般形式中)表示为“矛盾响应图”；两个主机在易受攻击的密码套件上表现出相同的密码套件指纹，但是存在两个主机都支持的密码套件，使得一台主机在该密码套件上易受攻击，而另一台主机则不受攻击。我们将补充性情况称为“兼容响应图”。</p>
<p>然后，我们使用图算法进一步拆分主机组。对于具有相同密码套件指纹的每组主机，我们构造一个图，其中每个节点代表一个主机。当且仅当两台主机的响应图兼容时，我们才会在这两台主机之间画一条边。然后，我们使用Gephi软件中实现的ForceAtlas2算法将图形嵌入到二维平面中。ForceAtlas2算法将通过边连接的节点聚集在一起，因此具有兼容响应图的节点被聚集在一起。行为相同的配置相同的服务器将连接到相同的节点，因此将具有相同的等级。由于这些服务器连接到相同的节点，ForceAtlas2将使它们彼此靠近。通过根据节点的度数对节点进行着色，可以很容易地在图中手动发现配置相似且行为相同的实现。然后，可以检查这些子组是否有候选对象，以便进行手动分析和负责任的披露。</p>
<ul>
<li>**一个漏洞组的示例：**图3提供了这种可视化的一个示例。该图清楚地显示了两个不同的子组，它们不共享边缘(这意味着它们的响应图是相互矛盾的，它们可能不共享相同的实现)。绿色显示的主机在TLS_RSA_WITH_AES_128_CBC_SHA和TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA上易受攻击，而粉色显示的服务器仅易受TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA的攻击，而在TLS_RSA_WITH_AES_128_CBC_SHA上不易受攻击。有趣的是，图形中间的主机(大部分为青色)不支持TLS_RSA_WITH_AES_128_CBC_SHA(它们在TLS_DHE_RSA_WITH_3DES_EDE_CBC_SHA上易受攻击)。他们可以与绿色或粉色组共享其实现，因此与这两个组的成员共享边缘。红色的主机与粉色的主机非常相似，但与蓝色的主机没有相同的边缘。这意味着要么存在第三组，要么青色组实际上属于绿色组，而红色组属于粉红色组。单个节点很可能是较大组的实现之一的罕见配置。我们进行了DNS查询，确定这两个组都是由捷克一家托管公司运营的。通过这种方式，我们还可以联系每个组中的其他知名网站，询问他们使用的是什么TLS实现。</li>
</ul>
<p><img src="/images/USS-2020-paper/Figure-3.jpg" alt="Figure-3：表2中的组#23的可视化。"></p>
<ul>
<li>**响应图的细分：**图4直观地显示了各种密码套件指纹的流行情况。大多数易受攻击的主机都是由几个非常常见的漏洞造成的。Amazon/OpenSSL和Citrix中新发现的漏洞占所有易受攻击主机的一半多一点。它们被列为#15和#84，并在第8.2节中进行了更详细的描述。此外，响应图#41和#75可能源自基于未打补丁的OpenSSL版本的实现，约占易受攻击主机的三分之一。在上述Czech托管公司中可以找到响应图#23。</li>
</ul>
<p><img src="/images/USS-2020-paper/Figure-4.jpg" alt="Figure-4：密码套件指纹流行程度的可视化。大多数易受攻击的主机都是由少数几个普遍存在的漏洞造成的。在上述密码套件指纹中，#84和#15是可利用的。在第8.2节中对它们进行了更详细的描述。"></p>
<h1>七、现实可利用的 Padding Oracle漏洞</h1>
<p>并非所有我们确定的Oracle都能启用有效的解密攻击。 本节的其余部分将更详细地说明开发。 我们发现的Padding Oracle基于直接消息侧信道，即基于TLS实现，其中两个错误状态触发来自TLS服务器的不同错误响应。 它们可以在BEAST攻击者模型中被利用，BEAST攻击者模型基于两个假设：（a）受害者客户端在攻击者的控制下访问网站，该网站触发对受害者服务器的HTTPS请求，并且（b）攻击者是MitM，并且可以 观察会话并修改传输的密文。 除了这些标准假设外，如果一个球满足两个附加要求：（R1）可观察性和（R2）完美的填充区分性。</p>
<p><img src="/images/USS-2020-paper/Figure-5.jpg" alt="Figure-5：在BEAST场景中利用可观察到的基于错误的Padding Oracle。发送的TLS警报数量不同导致密文总长度不同。"></p>
<h2 id="（R1）可观察性">（R1）可观察性</h2>
<p>与计时侧信道不同，在TLS的情况下，很少关注直接消息侧信道，而且通常的智慧似乎假设攻击者看不到它们。实际上，对于在所有错误情况下都发送单个警报的实现来说，情况确实如此，行为是相同的，可能只是警报消息的内容不同。因为警报消息是加密的，所以攻击者无法利用此类行为来创建旁路。然而，我们确定了许多实现确实在行为上表现出明显差异的情况。这些可观察到的差异大致可以分为两类：</p>
<ul>
<li>**TCP层：**我们发现TCP层中的实现泄露了有关填充有效性的信息。例如，在Amazon的例子中，大多数带有无效填充的测试向量都会导致服务器立即关闭TCP连接。但是，精心设计的特定测试向量导致服务器在保持TCP连接打开的同时中止TLS会话。</li>
<li>**TLS记录数：**我们观察到TLS服务器根据填充有效性使用不同数量的记录进行响应。虽然攻击者无法解密这些记录，但他能够观察到密文的总长度。例如，在有效填充的情况下，来自组23(参见表2)的服务器以一个TLS警报响应，而对于无效的填充，它们以两个TLS警报响应。</li>
</ul>
<p>假设攻击者A可以根据最后一个填充字节的有效性区分VALID_PADDING和INVALID_PADDING两种情况(参见图6)。攻击者按如下方式解密HTTPS会话Cookie：</p>
<ol>
<li>A引诱受害者客户端加载他控制的网页。此网页包含向受攻击服务器发送HTTPS请求的JavaScript代码，带有A选择的URL。</li>
<li>A观察第一次TLS握手，并确定协商的密码套件是否易受填充预言攻击。<br>
如果没有，他就放弃。</li>
<li>如果使用了易受攻击的密码套件，则A指示客户端发送另一个HTTPS请求，修改URL，使得会话cookie的第一个字符是密码块Ci中的最后一个字节。</li>
<li>作为MITM，A截取密文(C1，…，Ci，…，Cn)并对其进行修改，使得Ci成为最后的密文块，例如通过用Ci替换Cn。</li>
<li>最后一个块的解密是伪随机变换，因此填充可能是无效的，从而触发可观察到的INVALID_PADDING错误事件。</li>
<li>在256个请求中，约有1个请求的填充将随机有效。当填充有效时，它最有可能是一个字节的长度，如图6所示。前面的字节将被TLS服务器解析为MAC数据，并且将以压倒性的概率无效。在本例中，A观察到VALID_PADDING错误事件，并将HTTPS会话Cookie的第一个字符计算为C(n−1)[−1]⊕C(i−1)[−1]，其中[−1]运算符表示获取块的最后一个字节。</li>
<li>然后，A准备另一个HTTPS URL，其中会话cookie的第二个字符被移位到Ci的最后一个字节，并且再次从步骤3开始。</li>
</ol>
<p><img src="/images/USS-2020-paper/Figure-6.jpg" alt="Figure-6：我们的攻击依赖于一个易受攻击的服务器，该服务器根据最后一个填充字节的有效性提供不同的响应。"></p>
<h2 id="（R2）完美填充区分性">（R2）完美填充区分性</h2>
<p>在上面的示例中，我们考虑了一个简单的Oracle，它允许根据最后一个填充字节的有效性区分VALIDATE_PADDING和INVALID_PADDING。然而，即使在提供不同的响应时，实现也不一定公开这样简单的Oracle。例如，较早的OpenSSL版本仅在包含至少两个完整有效填充块的空记录的特定情况下才以不同的警报消息响应[37]。我们发现了仅对包含几个有效填充或MAC字节的密文作出不同响应的易受攻击的实现。这样的漏洞不太可能被利用，因为使用上面的算法，攻击者需要执行256个以上的Oracle查询才能解密每个字节。攻击者可以通过在Cookie值后面直接插入他选择的字节来克服此限制。由于CBC的延展性，只能插入一个连续选择的数据块。因此，如果选择的填充字节数小于块大小，则CBC允许创建实际利用漏洞。</p>
<p>因此，在我们的影响评估中，我们采取了保守的方式。要将易受攻击的实现视为可利用的，我们要求它以VALID_PADDING响应最多具有一块有效填充的密文。我们称这样的Oracle为<em>strong</em>称其他Oracle为<em>weak</em>。除了这两个Oracle之外，我们还考虑不正确验证完整的CBC填充而只验证MAC的Oracle。我们称这样的Oracle为POODLE Oracle。这些Oracle也可以通过应用类似POODLE的攻击来攻击。</p>
<p>表2中的列R2标识了Oracle强度。例如，具有第二流行的密码套件指纹(#41)的服务器使用RECORD_OVERFLOW响应表1中格式错误的记录#6和#7。在所有其他情况下，服务器发送BAD_RECORD_MAC警报。我们认为该组是薄弱的，因为攻击者需要发送一个以上的有效填充块来触发具有错误记录#6或#7的RECORD_OVERFLOW警报。</p>
<p>我们认为具有密码套件指纹#2的服务器是<em>strong</em> Oracle。此组中的服务器以TCP连接重置响应。如果他们接收到具有有效填充的格式错误的记录(参见格式错误的记录#20和#21)。还有几个群体的行为类似于POODLE。这些组忽略MAC字节中的修改，并以不同方式响应格式错误的记录#8、#9、#17和#18。</p>
<h2 id="可利用性">可利用性</h2>
<p>我们认为看得见的POODLE和看得见的<em>strong</em> Oracle是可以开发的。我们认为所有其他的Oracle都是不可利用的。但是，请注意，可以使用更高级的技术来利用<em>weak</em> Oracle。因此，我们对可利用主机数量的估计是保守的较低估计。</p>
<ul>
<li>**可利用主机的估计：**我们的扫描发现18,257台主机易受Padding Oracle攻击。其中，11225条(61.4%)表现出可观察到的漏洞，使得攻击者能够区分两条格式错误的记录。另请参见表2中的列R1。至少有10,688台主机提供了<em>strong</em>或POODLE样式的Oracle，占易受攻击主机的58%。另请参见表2中的列R2。总共有10,501台主机实际上是可利用的，即它们同时满足这两个要求。</li>
<li>CBC密码套件协商好了吗？大多数现代浏览器都支持AEAD密码套件。如果易受攻击的服务器偏爱AEAD密码套件，则它们可能会被协商，从而阻止CBC攻击。31651台主机(4.03%)仅支持RC4或CBC密码套件。由于[30]的原因，大多数现代浏览器都禁用了对RC4密码套件的支持，因此现代浏览器可能会与这些主机协商CBC密码套件。在这些主机中，有1400台容易受到Padding Oracle攻击。</li>
</ul>
<h1>八、发现</h1>
<p>在本节中，我们将回顾我们的假设，并介绍我们在不同实现中发现的值得注意的漏洞。</p>
<h2 id="我们最初的假设成立吗？">我们最初的假设成立吗？</h2>
<p>我们执行扫描的前提是，为了检测易受攻击的主机，必须使用不同的密码套件和协议版本进行扫描。如下所述，我们的发现证实了这一假设。</p>
<ul>
<li>
<p>**是否有必要使用不同的协议版本进行扫描？**Böck等人发现一些服务器仅在其支持的某些协议版本上表现出RSA Padding Oracle漏洞[9]。如第3.5节所述，我们怀疑CBC Padding漏洞也是如此。我们的发现证实了这一假设：我们发现至少有744台主机在TLS 1.0和1.2中都支持相同的密码套件，但仅在其中一个版本中使用该密码套件时易受攻击。在某些情况下，易受攻击的协议版本是较新的版本，而在其他情况下，则是较旧的版本。作为前一种情况的示例，vine.co在使用TLS 1.2和TLS_RSA_WITH_3DES_EDE_CBC_SHA密码套件时容易受到攻击，但在TLS 1.0中使用相同的密码套件时不会受到攻击。</p>
<p>令人惊讶的是，当只有一个协议版本使用相同的密码套件易受攻击时，新版本易受攻击的情况会更多。在这744台主机中，120台主机在TLS 1.0中易受攻击，但在TLS 1.2中不易受攻击；624台主机在TLS 1.2中易受攻击，但在TLS 1.0中不易受攻击。</p>
</li>
<li>
<p>**有必要使用不同的密码套件进行扫描吗？**Böck等人还发现，为了检测出尽可能多的漏洞，有必要使用不同的密码套件进行扫描[9]。在上面的工作中，即使在使用不同的对称密码扫描密码套件时，这一发现仍然成立，而漏洞存在于(理论上无关的)RSA实现中。</p>
<p>我们在我们的结果中发现了类似的行为。我们发现至少601台主机具有两个密码套件，一个是易受攻击的，一个是安全的，两个密码套件之间唯一的区别是密钥交换算法。这一发现是不直观的，因为人们会认为一个实现在使用相同对称密码的所有密码套件上都是统一易受攻击或安全的。举个例子，当将TLS_RSA_WITH_AES_256_CBC_SHA256与TLS 1.2一起使用时，一个网站是安全的，但当将TLS_DHE_RSA_WITH_AES_256_CBC_SHA256与TLS 1.2一起使用时，网站容易受到攻击。</p>
</li>
<li>
<p>**服务器行为背后的基本原理：**这两种行为看起来都不直观，但实际上都是意料之中的。许多实现采用完全不同的代码路径，具体取决于协商的密码套件或协议版本。例如，这些代码路径可能依赖于硬件加速，或者在可能的情况下使用优化的程序集实现。因此，即使使用相同的对称密码，也很可能(如我们所见，这很常见)发现仅在某些受支持的密码套件和协议版本中显示漏洞的实现。</p>
</li>
</ul>
<h2 id="值得注意的漏洞">值得注意的漏洞</h2>
<p>在我们的扫描中，我们识别了来自Cisco的多个设备、两个不同的IBM服务器以及来自SonicWall和Oracle的多个设备。在下面，我们将描述我们在Citrix、OpenSSL和IBM服务器中发现并负责任地披露的特定漏洞。我们的披露仍在进行中。在https://github.com/RUB-NDS/TLS-Padding-Oracles 上总结了我们的最新发现和受影响供应商实施的对策的现状。</p>
<ul>
<li>
<p>**Amazon/OpenSSL：**在Amazon安全团队的帮助下，我们发现了一个漏洞(密码套件指纹#15)，该漏洞主要存在于Amazon服务器和Amazon网络服务(Amazon Web Services，AWS)上。受此漏洞影响的主机会立即使用BAD_RECORD_MAC和CLOSE_NOTIFY警报响应大多数记录，然后关闭连接。但是，如果主机遇到具有有效填充和MAC的零长度记录，则无论MAC的有效性如何，它们都不会立即关闭TCP连接。相反，它们在发送CLOSE_NOTIFY警报后使连接保持活动状态超过4秒。这种行为差异在网络上很容易观察到。请注意，触发此超时不需要MAC值正确，只需创建导致解密数据长度为零的有效填充即可。因此，我们把它归类为一个<em>strong</em> Oracle，也是可以利用的。</p>
<p>进一步调查发现，Amazon服务器正在运行一个使用OpenSSL 1.0.2 API的实现。在某些情况下，根据发生的是MAC错误还是填充错误，对API的函数调用会返回不同的错误代码。然后，Amazon应用程序根据这些错误代码采用不同的代码路径，不同的路径会在TCP层产生明显的差异。仅当未使用AES-NI时，才会出现易受攻击的行为。</p>
<p>事实上，我们之前已经在实验室环境中手动测试了易受攻击的OpenSSL代码，但没有发现此漏洞。这是因为该漏洞仅在特定条件的组合下表现出来：OpenSSL和外部代码之间的微妙交互，并且仅在不使用AES-NI的情况下才会出现，这在当今是很少见的。我们认为这是一个例证，说明了大规模扫描在检测实验室测试有时可能会遗漏的漏洞方面的用处。</p>
<p>我们怀疑此OpenSSL行为是我们发现的许多类似漏洞的基础，而不仅仅是漏洞#15。因此，我们希望一旦OpenSSL发布修补程序，其他漏洞也会因此得到修复。该漏洞被分配到CVE-2019-1559。</p>
</li>
<li>
<p>**IBM的漏洞：**我们在IBM托管的服务器中发现了多个漏洞。表2中的密码套件指纹#77描述了其中一个漏洞。如果MAC或填充不正确，受影响的服务器会发出BAD_RECORD_MAC警报。如果填充正确且MAC不完整或不存在，服务器将以DECODE_ERROR警报响应。即使记录太短而不能包含MAC，也会发生后一种行为，只要记录包含至少两个密文块，而与使用的MAC算法无关。攻击者只能使用IV发送两个块，这保证没有足够的空间容纳MAC。这为攻击者提供了典型的CBC Padding Oracle。因此，我们认为这是一个<em>strong</em> Oracle。由于警报是加密的，因此我们将此漏洞归类为不可察觉，因此无法利用Oracle。IBM安全团队决定在受影响的服务器上禁用CBC密码套件，只支持AES-GCM。</p>
</li>
<li>
<p>**Citrix：**表2中的密码套件指纹#84标识了描述的漏洞。易受攻击的实现首先检查最后一个填充字节，然后验证MAC。如果MAC无效，服务器将关闭连接。这是通过连接超时或RST来完成的，具体取决于剩余填充字节的有效性。但是，如果MAC有效，服务器会检查其余所有填充字节是否正确。如果它们不是，则服务器以BAD_RECORD_MAC和RST作为响应(如果它们有效，则记录格式良好并被接受)。我们在图7中可视化了这种行为。可以通过类似于POODLE的攻击来利用这种行为。因为Oracle也是可以观察到的，所以我们认为这个群体是可以利用的。我们首先在Amazon Web服务中检测到此漏洞。我们与亚马逊安全团队合作，确定Citrix Application Delivery Controller(ADC)和NetScaler Gateway应对此行为负责。该漏洞被指定为CVE-2019-6485。</p>
</li>
</ul>
<p><img src="/images/USS-2020-paper/Figure-7.jpg" alt="Figure-7：使用密码套件指纹#84的Citrix实施的行为。"></p>
<h1>九、相关工作</h1>
<p>现在，我们重点介绍过去的工作，这些工作侧重于对现代Internet上的漏洞进行大规模扫描。对于有关padding oracle攻击的相关工作的调查，我们请读者参考第3节。ZMap [18]是一种能够达到较高扫描速度的网络扫描仪。 Durumeric等人[17]使用ZMap扫描IPv4地址空间以量化Heartbleed漏洞[32]的影响。 Heninger等人[19]扫描TLS和SSH，以查找由于熵不足而产生的弱密钥。Adrian等人[2]引入了Logjam漏洞，并根据攻击者的计算资源，使用Internet范围内的扫描来量化其影响。 Aviram等人[5]引入了DROWN漏洞，并类似地使用了Internet范围内的扫描来量化其影响。 Böck等人[9]像我们在这里一样，对Bleichenbacher的漏洞进行了大规模扫描，同时还观察了诸如TCP连接状态变化之类的侧信道。 Valenta等人[38]扫描了椭圆曲线实施中的已知漏洞，寻找可以启用强大攻击的组合CurveSwap。</p>
<h1>十、总结和未来工作</h1>
<p>这项工作表明，现代Internet上仍然存在padding oracle漏洞，并且很可能继续威胁用户的安全。 这些漏洞通常很难被发现：它们可能依赖于细微的侧信道或需要专门设计的输入才能触发。</p>
<p>过去，新的重大TLS攻击对生态系统产生了积极影响。 例如，Adrian等人的工作[2]导致了“enforcement”工作，主要的浏览器改变了行为并拒绝连接到具有弱DH参数的服务器。 安全社区如何更好地帮助服务器操作员检测和补救更细微的漏洞（尤其是CBC oracle和一般的其他类别的漏洞）是一个有趣的开放问题。</p>
<p>在CBC oracle的上下文中，一种解决方案是完全禁止CBC密码套件。 最近，主要的浏览器供应商已经宣布打算删除对旧的1.0和1.1 TLS版本的支持。 这迫使许多服务器操作员升级其实现或更改配置。 确实，浏览器供应商也可以取消对CBC密码套件的支持，再次迫使服务器运营商进行升级。 这些变化并非没有代价。 它们通常需要提前几个月通知，可能需要浏览器供应商之间进行协调，并且显然会为服务器操作者增加工作量。</p>
<p>我们的结果再次证实，大规模扫描使发现以前在实验室测试中未发现的各种安全漏洞变得可行。 我们相信，在执行大规模扫描时，不仅在TLS上下文中，我们的方法引起了广泛关注。 一个未解决的问题是如何确定易受攻击的实现版本及其供应商。 在SSH和IPsec协议中，这些数据通常作为协议中的消息字段进行传输。在TLS中传输此类数据将使披露更容易，但另一方面将导致隐私问题和更容易的指纹识别。</p>
<h1>致谢</h1>
<p>我们要感谢Dennis Felsch，他在我们的硬件和网络基础设施方面为我们提供了帮助，以及我们的匿名评论者提供了许多有洞察力的意见。此外，我们要感谢Amazon、Citrix和OpenSSL团队的专业回应和对信息披露的帮助。</p>
<p>Nimrod Aviram得到了以色列科技部的奖学金、Check Point信息安全研究所的奖学金以及Yitzhak和Chaya Weinstein信号处理研究所的奖学金。Juraj Somorovsky通过未来信托项目得到欧盟委员会的支持(赠款700542-未来-信托-H2020-DS2015-1)。Robert Merget通过SIWECOS项目得到了德国联邦经济事务和能源部的支持，该项目名为“IT-Sinherheit in der Wirtschaft”(IT-Silherheit in der Wirtschaft)计划。</p>
<h1>参考</h1>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">[1] Openssl security advisory. CVE-2018-0733.</span><br><span class="line">[2] ADRIAN, D., BHARGAVAN, K., DURUMERIC, Z., GAUDRY, P., GREEN, M., HALDERMAN, J. A., HENINGER, N., SPRINGALL, D., THOMÉ, E., VALENTA, L., ET AL. Imperfect forward secrecy: How diffie-hellman fails in practice. In Proceedings of the 22nd ACM SIGSAC Conference on Computer and Communications Security (2015), ACM, pp. 5–17.</span><br><span class="line">[3] ALBRECHT, M. R., AND PATERSON, K. G. Lucky microseconds: A timing attack on amazon’s s2n implementation of TLS. In Advances in Cryptology - EUROCRYPT 2016 - 35th Annual International Conference on the Theory and Applications of Cryptographic Techniques, Vienna, Austria, May 8-12, 2016, Proceedings, Part I (2016), pp. 622–643.</span><br><span class="line">[4] ALFARDAN, N. J., AND PATERSON, K. G. Lucky Thirteen: Breaking the TLS and DTLS Record Protocols. 2013 IEEE Symposium on Security and Privacy 0 (2013), 526–540.</span><br><span class="line">http:&#x2F;&#x2F;www.isg.rhul.ac.uk&#x2F;tls&#x2F;TLStiming.pdf.</span><br><span class="line">[5] AVIRAM, N., SCHINZEL, S., SOMOROVSKY, J., HENINGER, N., DANKEL, M., STEUBE, J., VALENTA, L., ADRIAN, D., HALDERMAN, J. A., DUKHOVNI, V., KÄSPER, E., COHNEY, S., ENGELS, S., PAAR, C., AND SHAVITT, Y. DROWN: Breaking TLS Using SSLv2. In 25th USENIX Security Symposium (USENIX Security 16) (Austin, TX, Aug. 2016), pp. 689–706.</span><br><span class="line">[6] BARDOU, R., FOCARDI, R., KAWAMOTO, Y., STEEL, G., AND TSAY, J.-K. Efficient Padding Oracle Attacks on Cryptographic Hardware. In Advances in Cryptology – CRYPTO (2012), Canetti and R. Safavi-Naini, Eds.</span><br><span class="line">[7] BENJAMIN, D. Tls ecosystem woes, Jan. 2018. Real World Crypto Symposium.</span><br><span class="line">[8] BLEICHENBACHER, D.</span><br><span class="line">Chosen ciphertext attacks against protocols based on the RSA encryption standard PKCS #1.</span><br><span class="line">In Advances in Cryptology — CRYPTO ’98, vol. 1462 of Lecture Notes in Computer Science. Springer Berlin &#x2F; Heidelberg, 1998.</span><br><span class="line">[9] BÖCK, H., SOMOROVSKY, J., AND YOUNG, C. Return of bleichenbacher’s oracle threat (ROBOT). In 27th USENIX Security Symposium (USENIX Security 18) (Baltimore, MD, 2018), USENIX Association, pp. 817–849.</span><br><span class="line">[10] BÖCK, H.</span><br><span class="line">A little POODLE left in GnuTLS (old versions), Nov. 2015. https:&#x2F;&#x2F;blog.hboeck.de&#x2F;archives&#x2F; 877-A-little-POODLE-left-in-GnuTLS-old-versions.</span><br><span class="line">html.</span><br><span class="line">[11] CANVEL, B., HILTGEN, A., VAUDENAY, S., AND VUAGNOUX, M. Password Interception in a SSL&#x2F;TLS Channel. In Advances in Cryptology - CRYPTO 2003, vol. 2729 of Lecture Notes in Computer Science. Springer Berlin &#x2F; Heidelberg, Aug. 2003.</span><br><span class="line">[12] DIERKS, T., AND ALLEN, C. The TLS Protocol Version 1.0.</span><br><span class="line">RFC 2246 (Proposed Standard), Jan. 1999. Obsoleted by RFC 4346, updated by RFCs 3546, 5746, 6176, 7465, 7507.</span><br><span class="line">[13] DIERKS, T., AND RESCORLA, E. The Transport Layer Security (TLS) Protocol Version 1.1. RFC 4346 (Proposed Standard), Apr. 2006. Obsoleted by RFC 5246, updated by RFCs 4366, 4680, 4681, 5746, 6176, 7465, 7507.</span><br><span class="line">[14] DIERKS, T., AND RESCORLA, E. The Transport Layer Security (TLS) Protocol Version 1.2. RFC 5246 (Proposed Standard), Aug. 2008. Updated by RFCs 5746, 5878, 6176, 7465, 7507, 7568, 7627, 7685.</span><br><span class="line">[15] DUONG, T., AND RIZZO, J. Cryptography in the web: The case of cryptographic design flaws in ASP.NET. In IEEE Symposium on Security and Privacy (2011).</span><br><span class="line">[16] DURUMERIC, Z., ADRIAN, D., MIRIAN, A., BAILEY, M., AND HALDERMAN, J. A.</span><br><span class="line">A search engine backed by Internet-wide scanning. In 22nd ACM Conference on Computer and Communications Security (Oct. 2015).</span><br><span class="line">[17] DURUMERIC, Z., LI, F., KASTEN, J., AMANN, J., BEEKMAN, J., PAYER, M., WEAVER, N., ADRIAN, D., PAXSON, V., BAILEY, M., ET AL. The matter of heartbleed. In Proceedings of the 2014 conference on internet measurement conference (2014), ACM, pp. 475–488.</span><br><span class="line">[18] DURUMERIC, Z., WUSTROW, E., AND HALDERMAN, J. A.</span><br><span class="line">Zmap: Fast internet-wide scanning and its security applications.</span><br><span class="line">[19] HENINGER, N., DURUMERIC, Z., WUSTROW, E., AND HALDERMAN, J. A. Mining your ps and qs: Detection of widespread weak keys in network devices.</span><br><span class="line">[20] IRAZOQUI, G., INCI, M. S., EISENBARTH, T., AND SUNAR, B. Lucky 13 strikes back. In Proceedings of the 10th ACM Symposium on Information, Computer and Communications Security (New York, NY, USA, 2015), ASIA CCS ’15, ACM, pp. 85–96.</span><br><span class="line">[21] JACOMY, M., VENTURINI, T., HEYMANN, S., AND BASTIAN, M. Forceatlas2, a continuous graph layout algorithm for handy network visualization designed for the gephi software. PLOS ONE 9, 6 (06 2014), 1–12.</span><br><span class="line">[22] JAGER, T., SCHINZEL, S., AND SOMOROVSKY, J. Bleichenbacher’s attack strikes again: breaking PKCS#1 v1.5 in XML Encryption. In Computer Security - ESORICS 2012 - 17th European Symposium on Research in Computer Security, Pisa, Italy, September 10-14, 2012. Proceedings (2012), S. Foresti and M. Yung, Eds., LNCS, Springer.</span><br><span class="line">[23] JAGER, T., AND SOMOROVSKY, J. How To Break XML Encryption. In The 18th ACM Conference on Computer and Communications Security (CCS) (Oct. 2011).</span><br><span class="line">[24] LABS, A. W. S. s2n: An implementation of the tls&#x2F;ssl protocols.</span><br><span class="line">[25] LANGLEY, A.</span><br><span class="line">The POODLE bites again, Nov. 2014.</span><br><span class="line">https:&#x2F;&#x2F;www.imperialviolet.org&#x2F;2014&#x2F;12&#x2F;08&#x2F; poodleagain.html.</span><br><span class="line">[26] MEYER, C., SOMOROVSKY, J., WEISS, E., SCHWENK, J., SCHINZEL, S., AND TEWS, E. Revisiting SSL&#x2F;TLS Implementations: New Bleichenbacher Side Channels and Attacks.</span><br><span class="line">In 23rd USENIX Security Symposium, San Diego, USA (August 2014).</span><br><span class="line">[27] MÖLLER, B., DUONG, T., AND KOTOWICZ, K. This POODLE bites: exploiting the SSL 3.0 fallback, 2014.</span><br><span class="line">[28] PETTERSSEN, Y. The POODLE has friends.</span><br><span class="line">[29] PETTERSSEN, Y. There are more POODLEs in the forest.</span><br><span class="line">[30] POPOV, A. Prohibiting RC4 Cipher Suites. RFC 7465 (Proposed Standard), Feb. 2015.</span><br><span class="line">[31] RESCORLA, E. The Transport Layer Security (TLS) Protocol Version 1.3. RFC 8446, 2018.</span><br><span class="line">[32] RIKU, ANTTI, MATTI, AND MEHTA. Heartbleed, cve-20140160, 2015. http:&#x2F;&#x2F;heartbleed.com&#x2F;.</span><br><span class="line">[33] RIZZO, J., AND DUONG, T.</span><br><span class="line">Practical padding oracle attacks. In Proceedings of the 4th USENIX conference on Offensive technologies (Berkeley, CA, USA, 2010), WOOT’10, USENIX Association, pp. 1–8.</span><br><span class="line">[34] RIZZO, J., AND DUONG, T. Here Come The XOR Ninjas, May 2011.</span><br><span class="line">[35] RONEN, E., PATERSON, K. G., AND SHAMIR, A. Pseudo constant time implementations of tls are only pseudo secure. In Proceedings of the 2018 ACM SIGSAC Conference on Computer and Communications Security (2018), ACM, pp. 1397–1414.</span><br><span class="line">[36] SCHEITLE, Q., HOHLFELD, O., GAMBA, J., JELTEN, J., ZIMMERMANN, T., STROWES, S. D., AND VALLINARODRIGUEZ, N. A Long Way to the Top: Significance, Structure, and Stability of Internet Top Lists. In Internet Measurement Conference (IMC’18), IMC’18 Community Contribution Award (Boston, USA, Nov. 2018), ACM, pp. 478–493.</span><br><span class="line">[37] SOMOROVSKY, J. Systematic fuzzing and testing of tls libraries. In Proceedings of the 2016 ACM SIGSAC Conference on Computer and Communications Security (2016), ACM, pp. 1492–1504.</span><br><span class="line">[38] VALENTA, L., SULLIVAN, N., SANSO, A., AND HENINGER, N. In search of curveswap: Measuring elliptic curve implementations in the wild. In 2018 IEEE European Symposium on Security and Privacy (EuroS&amp;P) (2018), IEEE, pp. 384–398.</span><br><span class="line">[39] VAUDENAY, S. Security Flaws Induced by CBC Padding —Applications to SSL, IPSEC, WTLS... In Advances in Cryptology — EUROCRYPT 2002, vol. 2332 of Lecture Notes in Computer Science. Springer Berlin &#x2F; Heidelberg, Apr. 2002.</span><br></pre></td></tr></table></figure>
<!-- flag of hidden posts --></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://titus.pub">Titus</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://titus.pub/2021/04/24/CyberSec/Paper-Reading-Scalable-Scanning-and-Automatic-Classification-of-TLS-Padding-Oracle-Vulnerabilities/">https://titus.pub/2021/04/24/CyberSec/Paper-Reading-Scalable-Scanning-and-Automatic-Classification-of-TLS-Padding-Oracle-Vulnerabilities/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://titus.pub" target="_blank">Titus</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/paper/">paper</a></div><div class="post_share"><div class="social-share" data-image="/images/USS-2020-paper/USS-2020-paper-cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div id="comment-switch"><span class="first-comment">Valine</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/avatar-1.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Titus</div><div class="author-info__description">在读打工人的学习和日常分享</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Jupiterliu"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Jupiterliu" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:taifengl@outlook.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">科研人，科研魂，科研就是人上人！！！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">「TLS Padding Oracle漏洞的可拓展扫描和自动分类」</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">摘要</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">一、介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">二、背景</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TLS%E6%8F%A1%E6%89%8B%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.1.</span> <span class="toc-text">TLS握手协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CBC%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E9%93%BE%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">CBC分组密码链接模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TLS%E8%AE%B0%E5%BD%95%E5%B1%82"><span class="toc-number">4.3.</span> <span class="toc-text">TLS记录层</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">三、Padding Oracle漏洞的历史</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Vaudenay%E5%BC%8F%E7%9A%84Padding-Oracles%E6%94%BB%E5%87%BB"><span class="toc-number">5.1.</span> <span class="toc-text">Vaudenay式的Padding Oracles攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BEAST%E6%94%BB%E5%87%BB%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.2.</span> <span class="toc-text">BEAST攻击模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#POODLE%E6%94%BB%E5%87%BB"><span class="toc-number">5.3.</span> <span class="toc-text">POODLE攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lucky13%E5%92%8C%E5%85%B6%E4%BB%96%E6%97%B6%E9%97%B4%E4%BE%A7%E4%BF%A1%E9%81%93%E6%94%BB%E5%87%BB"><span class="toc-number">5.4.</span> <span class="toc-text">Lucky13和其他时间侧信道攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bleichenbacher%E6%94%BB%E5%87%BB%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D"><span class="toc-number">5.5.</span> <span class="toc-text">Bleichenbacher攻击及其变种</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">四、扫描与评估的方法论</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E5%90%91%E9%87%8F%E7%94%9F%E6%88%90"><span class="toc-number">6.1.</span> <span class="toc-text">测试向量生成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E9%94%99%E8%AF%AF%E8%AE%B0%E5%BD%95"><span class="toc-number">6.1.1.</span> <span class="toc-text">格式错误记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E6%A0%BC%E5%BC%8F%E9%94%99%E8%AF%AF%E7%9A%84%E8%AE%B0%E5%BD%95%E4%B8%8E%E5%8D%8F%E8%AE%AE%E7%89%88%E6%9C%AC%E5%92%8C%E5%AF%86%E7%A0%81%E5%A5%97%E4%BB%B6%E7%BB%84%E5%90%88"><span class="toc-number">6.1.2.</span> <span class="toc-text">将格式错误的记录与协议版本和密码套件组合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E9%AA%8C%E6%A3%80%E9%AA%8C%E5%90%91%E9%87%8F%E8%A7%84%E7%BA%A6"><span class="toc-number">6.2.</span> <span class="toc-text">经验检验向量规约</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BE%A4%E9%9B%86%E6%BC%8F%E6%B4%9E"><span class="toc-number">6.3.</span> <span class="toc-text">群集漏洞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">五、大规模TLS扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TLS%E6%90%9C%E5%AF%BB%E5%99%A8"><span class="toc-number">7.1.</span> <span class="toc-text">TLS搜寻器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%A7%E8%A1%8CTLS%E6%89%AB%E6%8F%8F"><span class="toc-number">7.2.</span> <span class="toc-text">执行TLS扫描</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">六、评估</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E6%89%80%E6%9C%89%E6%A0%BC%E5%BC%8F%E9%94%99%E8%AF%AF%E7%9A%84%E8%AE%B0%E5%BD%95%E8%BF%9B%E8%A1%8C%E9%A2%84%E6%89%AB%E6%8F%8F"><span class="toc-number">8.1.</span> <span class="toc-text">对所有格式错误的记录进行预扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Alexa-Top-100%E4%B8%87%E6%89%AB%E6%8F%8F"><span class="toc-number">8.2.</span> <span class="toc-text">Alexa Top 100万扫描</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E8%81%9A%E7%B1%BB%E6%96%B9%E6%B3%95%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="toc-number">8.3.</span> <span class="toc-text">我们聚类方法的结果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">七、现实可利用的 Padding Oracle漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88R1%EF%BC%89%E5%8F%AF%E8%A7%82%E5%AF%9F%E6%80%A7"><span class="toc-number">9.1.</span> <span class="toc-text">（R1）可观察性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%88R2%EF%BC%89%E5%AE%8C%E7%BE%8E%E5%A1%AB%E5%85%85%E5%8C%BA%E5%88%86%E6%80%A7"><span class="toc-number">9.2.</span> <span class="toc-text">（R2）完美填充区分性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E5%88%A9%E7%94%A8%E6%80%A7"><span class="toc-number">9.3.</span> <span class="toc-text">可利用性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text">八、发现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E6%9C%80%E5%88%9D%E7%9A%84%E5%81%87%E8%AE%BE%E6%88%90%E7%AB%8B%E5%90%97%EF%BC%9F"><span class="toc-number">10.1.</span> <span class="toc-text">我们最初的假设成立吗？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%BC%E5%BE%97%E6%B3%A8%E6%84%8F%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="toc-number">10.2.</span> <span class="toc-text">值得注意的漏洞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">11.</span> <span class="toc-text">九、相关工作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">12.</span> <span class="toc-text">十、总结和未来工作</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">13.</span> <span class="toc-text">致谢</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">14.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/11/16/Security-in-Robotic-Vehicle/" title="Security in Robotic Vehicle"><img src="/images/Security-in-Robotic-Vehicle/poster.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Security in Robotic Vehicle"/></a><div class="content"><a class="title" href="/2022/11/16/Security-in-Robotic-Vehicle/" title="Security in Robotic Vehicle">Security in Robotic Vehicle</a><time datetime="2022-11-16T09:45:05.000Z" title="发表于 2022-11-16 17:45:05">2022-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/10/Blender-Learning/" title="Blender Learning"><img src="https://i.ytimg.com/vi/XHyM9T4vYgo/maxresdefault.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Blender Learning"/></a><div class="content"><a class="title" href="/2022/11/10/Blender-Learning/" title="Blender Learning">Blender Learning</a><time datetime="2022-11-10T02:29:48.000Z" title="发表于 2022-11-10 10:29:48">2022-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/09/WritingWithLatex/" title="Writing with Latex"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/45/LaTeX_project_logo_bird.svg/800px-LaTeX_project_logo_bird.svg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Writing with Latex"/></a><div class="content"><a class="title" href="/2022/11/09/WritingWithLatex/" title="Writing with Latex">Writing with Latex</a><time datetime="2022-11-09T13:12:37.000Z" title="发表于 2022-11-09 21:12:37">2022-11-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Titus</div><div class="footer_custom_text">Hi, welcome to my <a target="_blank" rel="noopener" href="https://jupiterliu.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://titus.pub/2021/04/24/CyberSec/Paper-Reading-Scalable-Scanning-and-Automatic-Classification-of-TLS-Padding-Oracle-Vulnerabilities/'
    this.page.identifier = '/2021/04/24/CyberSec/Paper-Reading-Scalable-Scanning-and-Automatic-Classification-of-TLS-Padding-Oracle-Vulnerabilities/'
    this.page.title = 'Paper Reading: Scalable Scanning and Automatic Classification of TLS Padding Oracle Vulnerabilities'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }

  document.getElementById('darkmode').addEventListener('click', () => {
    setTimeout(() => window.disqusReset(), 200)
  })
}

if ('Valine' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script src="/js/title.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="false" async="async"></script><script>(function(d, w, c) {
    w.ChatraID = 'ieLDyj6FZZqXq8A6E';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>